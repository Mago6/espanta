<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Gestión 25 Plantas</title>
<style>
body { font-family: Arial; background:#f0fff0; padding:20px; }
h2 { text-align:center; margin-bottom:20px; }

.selection-panel { margin-bottom:15px; display:flex; gap:10px; align-items:center; }
.selection-panel select { padding:5px; border-radius:4px; }

.main-container { display:flex; gap:20px; }

.viewer { width:400px; height:300px; background:#f7fff7; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); display:flex; align-items:center; justify-content:center; }
.plant-img { width:100%; height:100%; object-fit:contain; border-radius:8px; }

.info-panel { width:250px; background:#fff; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); padding:10px; display:flex; flex-direction:column; gap:5px; }
.info-item { display:flex; justify-content:space-between; }
input { width:60px; text-align:right; border-radius:4px; border:1px solid #ccc; padding:2px 4px; }

.mini-calendar { width:100%; display:grid; grid-template-columns: repeat(7, 1fr); gap:2px; margin-top:5px; font-size:10px; }
.day-box { width:20px; height:20px; display:flex; align-items:center; justify-content:center; border-radius:3px; color:#fff; font-weight:bold; cursor:pointer; }
.germinacion { background:#a5d6a7; }
.plantula { background:#66bb6a; }
.vegetativo { background:#2e7d32; }
.floracion_media { background:#ffb74d; color:#000; }
.floracion_final { background:#f57c00; }
.cosecha { background:#8d6e63; }
.current-day { border:2px solid #000; }

button { margin-top:5px; padding:5px; border-radius:4px; border:none; background:#2e7d32; color:white; cursor:pointer; font-size:12px; }
</style>
</head>
<body>

<h2>Gestión de 25 Plantas</h2>

<div class="selection-panel">
  <label>Selecciona Planta:</label>
  <select id="plantSelect"></select>
  <label>Fecha inicio:</label>
  <input type="date" id="startDate">
  <button id="applyStart">Aplicar</button>
</div>

<div class="main-container">
  <div class="viewer">
    <img id="plantImg" class="plant-img" src="week01.webp" alt="Planta">
  </div>

  <div class="info-panel">
    <div class="info-item"><label>Semana:</label><input type="number" id="weekInput" min="1" max="12"></div>
    <div class="info-item"><label>Etapa:</label><input type="text" id="stageInput"></div>
    <div class="info-item"><label>Altura:</label><input type="number" id="heightInput"></div>
    <div class="info-item"><label>N:</label><input type="number" id="nInput"></div>
    <div class="info-item"><label>P:</label><input type="number" id="pInput"></div>
    <div class="info-item"><label>K:</label><input type="number" id="kInput"></div>
    <button id="updateBtn">Actualizar Datos</button>
    <div class="mini-calendar" id="miniCalendar"></div>
  </div>
</div>

<script>
const NUM_PLANTS = 25;
const plantSelect = document.getElementById('plantSelect');
const plantImg = document.getElementById('plantImg');
const weekInput = document.getElementById('weekInput');
const stageInput = document.getElementById('stageInput');
const heightInput = document.getElementById('heightInput');
const nInput = document.getElementById('nInput');
const pInput = document.getElementById('pInput');
const kInput = document.getElementById('kInput');
const miniCalendar = document.getElementById('miniCalendar');
const startDateInput = document.getElementById('startDate');

let startDateValue = new Date();
let plantsData = {};
let currentPlant = 'Planta01';
const today = new Date();

// Inicializar plantas
for(let i=1;i<=NUM_PLANTS;i++){
  const id = 'Planta'+String(i).padStart(2,'0');
  plantsSelectOption = document.createElement('option');
  plantsSelectOption.value = id;
  plantsSelectOption.textContent = id;
  plantSelect.appendChild(plantsSelectOption);

  plantsData[id] = { week:1, stage:'Germinación', height:0, nutrients:{n:0,p:0,k:0} };
}

plantSelect.value = currentPlant;

// Funciones
function randomRange(min,max){ return Math.round(min + Math.random()*(max-min)); }

function getStage(week){
  if(week<=1) return 'Germinación';
  if(week<=3) return 'Plántula';
  if(week<=7) return 'Vegetativo';
  if(week===8||week===9) return 'Floración media';
  if(week<=11) return 'Floración final / Maduración';
  return 'Cosecha';
}

function getStageClass(week){
  const s = getStage(week);
  switch(s){
    case 'Germinación': return 'germinacion';
    case 'Plántula': return 'plantula';
    case 'Vegetativo': return 'vegetativo';
    case 'Floración media': return 'floracion_media';
    case 'Floración final / Maduración': return 'floracion_final';
    case 'Cosecha': return 'cosecha';
  }
}

function getDataForWeek(week){
  const stage = getStage(week);
  let height,nutrients;
  switch(stage){
    case 'Germinación': height=randomRange(1,3); nutrients={n:0,p:0,k:0}; break;
    case 'Plántula': height=randomRange(4,8); nutrients={n:10,p:10,k:10}; break;
    case 'Vegetativo': height=randomRange(9,20); nutrients={n:40,p:20,k:30}; break;
    case 'Floración media': height=randomRange(21,30); nutrients={n:30,p:25,k:35}; break;
    case 'Floración final / Maduración': height=randomRange(31,40); nutrients={n:20,p:20,k:40}; break;
    case 'Cosecha': height=randomRange(41,45); nutrients={n:10,p:10,k:20}; break;
  }
  return {week,stage,height,nutrients};
}

function loadPlant(plantId){
  currentPlant = plantId;
  const data = plantsData[plantId];

  weekInput.value = data.week;
  stageInput.value = data.stage;
  heightInput.value = data.height;
  nInput.value = data.nutrients.n;
  pInput.value = data.nutrients.p;
  kInput.value = data.nutrients.k;

  plantImg.src = `week${String(data.week).padStart(2,'0')}.webp`;

  generateMiniCalendar(plantId);
}

function generateMiniCalendar(plantId){
  const data = plantsData[plantId];
  miniCalendar.innerHTML = '';
  for(let week=1; week<=12; week++){
    for(let day=0; day<7; day++){
      const d = new Date(startDateValue);
      d.setDate(startDateValue.getDate() + (week-1)*7 + day);
      const box = document.createElement('div');
      box.className = 'day-box ' + getStageClass(week);
      if(today.toDateString() === d.toDateString()) box.classList.add('current-day');
      box.title = `Semana ${week} - ${getStage(week)}\n${d.toLocaleDateString()}`;
      box.textContent = d.getDate();
      miniCalendar.appendChild(box);
    }
  }
}

// Actualizar datos manualmente
document.getElementById('updateBtn').addEventListener('click',()=>{
  const data = {
    week: parseInt(weekInput.value),
    stage: stageInput.value,
    height: parseFloat(heightInput.value),
    nutrients:{n:parseFloat(nInput.value),p:parseFloat(pInput.value),k:parseFloat(kInput.value)}
  };
  plantsData[currentPlant] = data;
  plantImg.src = `week${String(data.week).padStart(2,'0')}.webp`;
  generateMiniCalendar(currentPlant);
});

// Cambio de planta
plantSelect.addEventListener('change', e => loadPlant(e.target.value));

// Aplicar fecha inicio cultivo
document.getElementById('applyStart').addEventListener('click',()=>{
  startDateValue = new Date(startDateInput.value);
  generateMiniCalendar(currentPlant);
});

// Init
loadPlant(currentPlant);
</script>
</body>
</html>
