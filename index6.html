<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Ciclo 12 semanas - 25 Plantas</title>
<style>
body { font-family: Arial; background:#f0fff0; padding:20px; }
h2 { margin-bottom:20px; text-align:center; }
.plants-grid { display:grid; grid-template-columns: repeat(5, 1fr); gap:20px; }

.plant-card {
  background:#fff; border-radius:12px; padding:10px;
  box-shadow:0 4px 12px rgba(0,0,0,0.1); display:flex; flex-direction:column; align-items:center;
}

.plant-img { width:100%; height:150px; object-fit:contain; border-radius:8px; background:#f7fff7; }

.info-panel { width:100%; margin-top:5px; display:flex; flex-direction:column; gap:4px; }
.info-item { display:flex; justify-content:space-between; font-size:12px; }
input { width:50px; text-align:right; border-radius:4px; border:1px solid #ccc; padding:2px 2px; font-size:12px; }

.mini-calendar { width:100%; display:grid; grid-template-columns: repeat(7, 1fr); gap:2px; margin-top:5px; font-size:10px; }
.day-box { width:20px; height:20px; display:flex; align-items:center; justify-content:center; border-radius:3px; color:#fff; font-weight:bold; cursor:pointer; }
.germinacion { background:#a5d6a7; }
.plantula { background:#66bb6a; }
.vegetativo { background:#2e7d32; }
.floracion_media { background:#ffb74d; color:#000; }
.floracion_final { background:#f57c00; }
.cosecha { background:#8d6e63; }
.current-day { border:2px solid #000; }
button { margin-top:5px; padding:4px 8px; border-radius:4px; border:none; background:#2e7d32; color:white; cursor:pointer; font-size:12px; }
</style>
</head>
<body>

<h2>Gestión de 25 Plantas - Ciclo 12 Semanas</h2>

<div style="display:flex; gap:10px; align-items:center; margin-bottom:10px;">
  <label>Fecha inicio cultivo:</label>
  <input type="date" id="startDate" value="">
  <button id="applyStart">Aplicar</button>
</div>

<div class="plants-grid" id="plantsGrid">
  <!-- Plantas generadas dinámicamente -->
</div>

<script>
const NUM_PLANTS = 25;
let startDateValue = new Date();
const plantsGrid = document.getElementById('plantsGrid');
const today = new Date();

function randomRange(min,max){ return Math.round(min + Math.random()*(max-min)); }

function getStage(week){
  if(week<=1) return 'Germinación';
  if(week<=3) return 'Plántula';
  if(week<=7) return 'Vegetativo';
  if(week===8||week===9) return 'Floración media';
  if(week<=11) return 'Floración final / Maduración';
  return 'Cosecha';
}

function getStageClass(week){
  const s = getStage(week);
  switch(s){
    case 'Germinación': return 'germinacion';
    case 'Plántula': return 'plantula';
    case 'Vegetativo': return 'vegetativo';
    case 'Floración media': return 'floracion_media';
    case 'Floración final / Maduración': return 'floracion_final';
    case 'Cosecha': return 'cosecha';
  }
}

function getDataForWeek(week){
  const stage = getStage(week);
  let height,nutrients;
  switch(stage){
    case 'Germinación': height=randomRange(1,3); nutrients={n:0,p:0,k:0}; break;
    case 'Plántula': height=randomRange(4,8); nutrients={n:10,p:10,k:10}; break;
    case 'Vegetativo': height=randomRange(9,20); nutrients={n:40,p:20,k:30}; break;
    case 'Floración media': height=randomRange(21,30); nutrients={n:30,p:25,k:35}; break;
    case 'Floración final / Maduración': height=randomRange(31,40); nutrients={n:20,p:20,k:40}; break;
    case 'Cosecha': height=randomRange(41,45); nutrients={n:10,p:10,k:20}; break;
  }
  return {week,stage,height,nutrients};
}

function generatePlantCard(id){
  const card = document.createElement('div');
  card.className='plant-card';
  card.dataset.plantId=id;

  const img = document.createElement('img');
  img.className='plant-img';
  img.src='week01.webp';
  img.alt=`Planta ${id}`;
  card.appendChild(img);

  const info = document.createElement('div');
  info.className='info-panel';
  ['Semana','Etapa','Altura','N','P','K'].forEach(field=>{
    const div = document.createElement('div');
    div.className='info-item';
    const label = document.createElement('label'); label.textContent=field+':';
    const input = document.createElement('input');
    input.id=`${field}${id}`;
    div.appendChild(label);
    div.appendChild(input);
    info.appendChild(div);
  });
  const updateBtn = document.createElement('button'); updateBtn.textContent='Actualizar'; 
  updateBtn.onclick=()=>updatePlant(id);
  info.appendChild(updateBtn);
  card.appendChild(info);

  const miniCal = document.createElement('div'); miniCal.className='mini-calendar'; miniCal.id=`miniCal${id}`;
  card.appendChild(miniCal);

  plantsGrid.appendChild(card);

  // Inicializar calendario
  generateMiniCalendar(id);
}

function generateMiniCalendar(plantId){
  const miniCal = document.getElementById(`miniCal${plantId}`);
  miniCal.innerHTML='';
  for(let week=1; week<=12; week++){
    for(let day=0; day<7; day++){
      const d = new Date(startDateValue);
      d.setDate(startDateValue.getDate() + (week-1)*7 + day);
      const box = document.createElement('div');
      box.className='day-box '+getStageClass(week);
      if(today.toDateString()===d.toDateString()) box.classList.add('current-day');
      box.title=`Semana ${week} - ${getStage(week)}\n${d.toLocaleDateString()}`;
      box.textContent=d.getDate();
      miniCal.appendChild(box);
    }
  }
}

function updatePlant(id){
  const week = parseInt(document.getElementById(`Semana${id}`).value);
  const data = getDataForWeek(week);
  document.getElementById(`Semana${id}`).value=data.week;
  document.getElementById(`Etapa${id}`).value=data.stage;
  document.getElementById(`Altura${id}`).value=data.height;
  document.getElementById(`N${id}`).value=data.nutrients.n;
  document.getElementById(`P${id}`).value=data.nutrients.p;
  document.getElementById(`K${id}`).value=data.nutrients.k;
  // Actualizar imagen
  const card = document.querySelector(`.plant-card[data-plant-id='${id}'] .plant-img`);
  card.src=`week${String(week).padStart(2,'0')}.webp`;
  // Actualizar mini calendario
  generateMiniCalendar(id);
}

// Generar las 25 plantas
for(let i=1;i<=NUM_PLANTS;i++) generatePlantCard(i);

// Aplicar fecha de inicio global
document.getElementById('applyStart').addEventListener('click',()=>{
  startDateValue = new Date(document.getElementById('startDate').value);
  for(let i=1;i<=NUM_PLANTS;i++) generateMiniCalendar(i);
});
</script>
</body>
</html>
